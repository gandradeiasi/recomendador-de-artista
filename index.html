<!DOCTYPE html>
<html>
<head>
    <title>Recomendador de Artistas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Estilos atualizados para cards horizontais */
        .container {
            display: flex;
            overflow-x: auto;
            padding: 20px 0;
            gap: 15px;
            min-height: 250px;
        }
        
        .card {
            flex: 0 0 200px;
            height: 200px;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 10px;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card:hover {
            transform: translateY(-3px);
        }

        .card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 8px;
        }

        .card h3 {
            margin: 0;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card p {
            margin: 5px 0 0 0;
            font-size: 12px;
            color: #666;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Outros estilos mantidos */
        /* ... */
    </style>
</head>
<body>
    <!-- O restante do HTML mantido -->
    
    <script>
        // Função findElbowGenres atualizada
        function findElbowGenres(sortedGenres) {
            if(sortedGenres.length < 3) return sortedGenres;
            
            const points = sortedGenres.map(([_, y]) => y);
            let elbowIndex = findOptimalElbowIndex(points);
            
            // Expande a seleção conforme necessário
            let selectedGenres = [];
            let padding = 0;
            
            while(selectedGenres.length < 3 && padding < 5) {
                const start = Math.max(0, elbowIndex - padding);
                const end = Math.min(sortedGenres.length - 1, elbowIndex + padding);
                selectedGenres = [...new Set(sortedGenres.slice(start, end + 1))];
                padding++;
            }

            console.log('Gêneros selecionados com padding:', selectedGenres);
            return selectedGenres.slice(0, 3); // Garante no máximo 3 gêneros
        }

        function findOptimalElbowIndex(points) {
            const n = points.length;
            const firstPoint = [0, points[0]];
            const lastPoint = [n-1, points[n-1]];
            let maxDistance = -Infinity;
            let elbowIndex = -1;

            for(let i = 1; i < n-1; i++) {
                const distance = perpendicularDistance(
                    [i, points[i]],
                    firstPoint,
                    lastPoint
                );
                
                if(distance > maxDistance) {
                    maxDistance = distance;
                    elbowIndex = i;
                }
            }
            return elbowIndex;
        }

        // Função getRecommendations atualizada com logs
        async function getRecommendations(accessToken, genres, savedTracks) {
            const savedArtists = new Set(
                savedTracks.flatMap(track => 
                    track.track.artists.map(artist => artist.id)
                )
            );

            console.log('Artistas salvos:', savedArtists);
            const recommendations = [];
            
            for(const genre of genres.slice(0, 3)) { // Limita a 3 gêneros
                console.log(`Processando gênero: ${genre[0]} (${genre[1]} músicas)`);
                
                let validArtists = [];
                let offset = 0;
                
                while(offset < 500 && validArtists.length === 0) {
                    const searchUrl = `https://api.spotify.com/v1/search?q=genre:${encodeURIComponent(genre[0])}&type=artist&limit=50&offset=${offset}`;
                    console.log(`Buscando: ${searchUrl}`);
                    
                    const response = await fetch(searchUrl, {
                        headers: {'Authorization': `Bearer ${accessToken}`}
                    });
                    const data = await response.json();
                    
                    validArtists = data.artists.items.filter(artist => {
                        const isValid = artist.genres.includes(genre[0]) && 
                                      !savedArtists.has(artist.id);
                        if(!isValid) console.log(`Artista ${artist.name} descartado - Gêneros: ${artist.genres}, Já salvo: ${savedArtists.has(artist.id)}`);
                        return isValid;
                    });
                    
                    offset += 50;
                }

                console.log(`Gênero ${genre[0]} encontrou ${validArtists.length} artistas válidos`);
                
                if(validArtists.length > 0) {
                    const randomArtist = validArtists[Math.floor(Math.random() * validArtists.length)];
                    recommendations.push(randomArtist);
                    console.log(`Artista selecionado para ${genre[0]}:`, randomArtist);
                }
            }
            
            console.log('Recomendações finais:', recommendations);
            return recommendations;
        }

        // Restante do código mantido
        // ...
    </script>
</body>
</html>
